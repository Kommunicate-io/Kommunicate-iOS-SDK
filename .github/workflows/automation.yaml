name: iOS Example App Tests

on:
  push:
    branches:
      - dev
  pull_request:

jobs:
  test:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Set up Xcode environment
      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '15.0' # Specify required Xcode version

      # Step 3: Install dependencies (CocoaPods)
      - name: Install CocoaPods dependencies
        run: pod install --project-directory=Example

      # Step 4: Run tests for Example App
      - name: Run Example App Tests
        run: |
          xcodebuild test \
            -workspace Example/Kommunicate.xcworkspace \ # Verify the workspace path is correct
            -scheme Kommunicate_Example \                # Ensure this scheme exists and is shared
            -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.1' \
            CODE_SIGNING_ALLOWED=NO \                    # Disable code signing for simulator builds
            | xcpretty
