name: iOS Example App Tests

on:
  push:
    branches:
      - dev
  pull_request:

jobs:
  test:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Set up Xcode environment
      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '16.1.0' # Specify required Xcode version

      # Step 3: Install dependencies (CocoaPods)
      - name: Install CocoaPods dependencies
        run: pod install --project-directory=Example

      # Step 4: Run tests for Example App
      - name: Run Example App Tests
        run: |
          xcodebuild test \
            -workspace Example/Kommunicate.xcworkspace \
            -scheme Kommunicate_Example \
            -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.1' \
            CODE_SIGNING_ALLOWED=NO \
            | xcpretty

      # Step 5: Debug logs
      - name: Debug logs
        run: |
          set -o pipefail && xcodebuild test \
          -workspace Example/Kommunicate.xcworkspace \
          -scheme Kommunicate_Example \
          -destination 'platform=iOS Simulator,name=iPhone 14,OS=16.4' \
          CODE_SIGNING_ALLOWED=NO || exit $?